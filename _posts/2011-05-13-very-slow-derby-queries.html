---
layout: post
title: Very Slow Derby Queries
date: 2011-05-13 17:47:08.000000000 +01:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories: []
tags: []
meta:
  _edit_last: '3991311'
  reddit: a:2:{s:5:"count";s:1:"0";s:4:"time";s:10:"1341700327";}
  _oembed_ce1bd956b9e7cabeb92acd58ce16e663: "{{unknown}}"
  _oembed_6fc6863a49be8e80c28c71a0a0d42db0: "{{unknown}}"
  _oembed_c047167f7efa8a8ec458ad99b2b6fa0d: "{{unknown}}"
author:
  login: iebtfdcouk
  email: ieb@tfd.co.uk
  display_name: Ian
  first_name: Ian
  last_name: Boston
permalink: "/2011/05/13/very-slow-derby-queries/"
---
<p>Here's a problem for anyone reading this.</p>
<p>I have a very slow derby query, and I am looking for alternatives. The query is of the form</p>
<p>select TR.rid from (<br />
select s.rid, ROW_NUMBER() OVER () AS R from (<br />
select distinct a.rid<br />
from cn_css a , cn_css a0<br />
where ( a0.cid = ? and a0.v = ? and a0.rid = a.rid ) AND 1 = 1 ) as s<br />
)  as TR<br />
where TR.R &gt; 0 and TR.R &lt;= 25+0</p>
<pre></pre>
<p>The table cn_css contains key value pairs in cid and v, and references row ids rid,  (ie columns rid, cid, v) so the inner<br />
select should find a distinct set of row ids, potentially sorted (although not in this example). The nest outer query numbers the results and the most outer query selects the first 25 results.</p>
<p>I have a feeling the select distinct is a bad idea as it will sort on disk, but at the moment I cant find an alternative. Still looking, will post back here if I find one.</p>
