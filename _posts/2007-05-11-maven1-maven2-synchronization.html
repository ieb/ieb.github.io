---
layout: post
title: Maven1 Maven2 synchronization
date: 2007-05-11 00:24:24.000000000 +01:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories: []
tags: []
meta: {}
author:
  login: iebtfdcouk
  email: ieb@tfd.co.uk
  display_name: Ian
  first_name: Ian
  last_name: Boston
permalink: "/2007/05/11/maven1-maven2-synchronization/"
---
<p>Maven 2 is now building in trunk, but the other problem that I'm trying to fix the jars that are deployed and where they are deployed to, there are 2 a number bash commands Im using to automate this process, recorded here so I dont forget them.</p>
<p>To do the maven1 and maven2 builds, I am deploying to dumy empty deployment targets, tomcatm1deploy and tomcatm2deploy</p>
<p><code> #maven2<br />
mvn -o -Dmaven.test.skip=true -Dmaven.tomcat.home=/Users/ieb/Caret/sakai22/tomcatm2deploy/ clean install sakai:deploy<br />
#maven 1<br />
maven -Dmaven.test.skip=true -Dmaven.tomcat.home=/Users/ieb/Caret/sakai22/tomcatm1deploy/ cln bld dpl   </code></p>
<p>Then to compare the deployed unpacked components and packed wars</p>
<p><code> find tomcatm1deploy -print | sed s/tomcatm1deploy/deploy/ | grep -v WEB-INF/tld &gt; m1deploy<br />
find tomcatm2deploy -print | sed s/tomcatm2deploy/deploy/ | sed s/M2/dev/ | grep -v maven | grep -v web.xml &gt; m2deploy<br />
diff m1deploy m2deploy  </code>This gives a list of differences that can be inspected manually to find the differences in deployment profile.</p>
<p>Next step it to unpack all the wars and compare the deployed jars within the wars. This is a little more complicated, find the wars into a file, sort the list of wars in each deployment and then iterate through listing the contents of the wars for jars only, comparing the final result.</p>
<p><code> #find the wars and store them<br />
find tomcatm1deploy -name '*.war' | sort &gt; m1wars<br />
find tomcatm2deploy -name '*.war' | sort &gt; m2wars<br />
# unpack<br />
for i in `cat m1wars `; do echo START $i; jar tvf $i | grep jar | cut -d'/' -f2- ; echo END $i; done &gt; m1deploywars<br />
for i in `cat m2wars `; do echo START $i; jar tvf $i | grep jar | cut -d'/' -f2- ; echo END $i; done | sed s/M2/dev/ &gt; m2deploywars<br />
# compare<br />
diff m1deploywars m2deploywars </code>Finally you have to dig though the poms and porject.xml files to make the deployments the same. This can mean overriding the transitive dependencies in jars.</p>
