---
layout: post
title: Maven 1 XML  and DOM Serialization in JDK 1.5
date: 2007-04-12 01:22:55.000000000 +01:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Thought
tags: []
meta: {}
author:
  login: iebtfdcouk
  email: ieb@tfd.co.uk
  display_name: Ian
  first_name: Ian
  last_name: Boston
permalink: "/2007/04/12/maven-1-xml-and-dom-serialization-in-jdk-15/"
---
<p>To serialise DOM in JAXP avoiding dependencies on Xerces there are 2  options. This is JDK 1.5 code and later, prior to that you can just use  Xerces</p>
<p>1. Use an identity transform, eg<br />
<code> TransformerFactory fact         = TransformerFactory.newInstance();<br />
Transformer idTransform = fact.newTransformer();<br />
Source input = new DOMSource(document);<br />
Result output = new StreamResult(System.out);<br />
idTransform.transform(input, output);</code></p>
<p>or 2. use DOM Level 3 Load and Store eg</p>
<p><code> OutputStream out = new FileOutputStream(fileName);<br />
DocumentBuilderFactory factory  = DocumentBuilderFactory.newInstance();<br />
DocumentBuilder builder = factory.newDocumentBuilder();<br />
DOMImplementation impl = builder.getDOMImplementation();<br />
DOMImplementationLS feature = (DOMImplementationLS)  impl.getFeature("LS","3.0"); LSSerializer serializer = feature.createLSSerializer();<br />
LSOutput output = feature.createLSOutput();<br />
output.setByteStream(out);<br />
output.setEncoding("UTF-8");<br />
serializer.write(doc, output); </code></p>
<p>However when you try to build this 2 with maven 1, it wont since maven1  pulls xerces 2.4.0 into the root classpath... which is somewhere arround  JDK 1.2.</p>
<p>The solution, maven.compile.fork=true</p>
<p>in project.properties of the project where you need to build, the  compiler forks and uses the JVM classpath without all the Maven 1 jars. Thanks to Josh Holtzman for finding this.</p>
<p>Incedently, the DOMImplementationRegistry appears to be empty in JDK5  with no impls at all.</p>
<p>The first method needs namespace support, so will fail to serialize if  the namespace is not found.</p>
