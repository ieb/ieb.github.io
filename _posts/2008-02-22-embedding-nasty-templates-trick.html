---
layout: post
title: Embedding Nasty Templates, Trick
date: 2008-02-22 13:38:52.000000000 +00:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories:
- Thought
tags: []
meta: {}
author:
  login: iebtfdcouk
  email: ieb@tfd.co.uk
  display_name: Ian
  first_name: Ian
  last_name: Boston
permalink: "/2008/02/22/embedding-nasty-templates-trick/"
---
<p>
If you have a template that, becuase of its nature/strucutre/purpose is not valid XML... yes it does happen... (sherlog search snippets), you can insert them into a comment and then a CDATA and retrieve them from the DOM. Yes, HTML comments are in the DOM.</p>
<pre class="prettyprint">
   render : function(templateName,contextObject)  {
  			if ( ! Template.templateCache[templateName] ) {
  			 var templateNode = document.getElementById(templateName);
  				 var firstNode = templateNode.firstChild;
  				 if ( firstNode &amp;&amp; ( firstNode.nodeType == 8 || firstNode.nodeType == 4)) {
  				 	template = templateNode.firstChild.data.toString();

  				 } else {
  				 	template = templateNode.innerHTML.toString();
  				 }
  				 Template.templateCache[templateName] = TrimPath.parseTemplate(template,templateName);
  			}
  			return Template.templateCache[templateName].process(contextObject);
  	},

 </pre>
<p>
nodeType 4 is CDATA, and nodeType 8 is  a comment. However, IE5 doesn't support the node.data property... so I could just do some regex to strip the CDATA or comment tags from converting the element to text.</p>
<p>
Using the approach makes it possible to have valid XHTML even with templates for other formats embedded inside the document</p>
