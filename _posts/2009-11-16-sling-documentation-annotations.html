---
layout: post
title: Sling Documentation Annotations
date: 2009-11-16 00:29:13.000000000 +00:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories: []
tags: []
meta:
  _edit_last: '3991311'
  delicious: a:3:{s:5:"count";s:1:"0";s:9:"post_tags";s:0:"";s:4:"time";s:10:"1288785600";}
  reddit: a:2:{s:5:"count";s:1:"0";s:4:"time";s:10:"1318752706";}
  _oembed_e487bc1290f5a83f013aedde92d5237a: "{{unknown}}"
author:
  login: iebtfdcouk
  email: ieb@tfd.co.uk
  display_name: Ian
  first_name: Ian
  last_name: Boston
permalink: "/2009/11/16/sling-documentation-annotations/"
---
<p>Its been noticed that documentation that is not in the same version control system as the code, is frequently not maintained. This leads to the users of the interfaces getting increasing fustrated as nothing appears to work, although to fair to the developers the users may well be looking at out of date documentation.</p>
<p>To address this in Sling/Sakai K2 I have just done a first pass at documentation annotations that are discovered at runtime to build a set of documentation for the Service. I say service, because Sling is OSGi based, and every HTTP service end point is implemented as a OSGi service implementing javax.servlet.Servlet. The approach could be used for any service, but I am using it for Sling Servlets.</p>
<p>How to use:</p>
<p>First off, all Servlets that are active in the system are automatically registered with the documentation system, and if any of them don't contain documentation there are some gentile reminders to the developer to create the documentation. If there are no documentation annotations present there are some <em>friendly</em> defaults.</p>
<p>add the documentation annotations to you build</p>
<pre>&lt;dependency&gt;
 &lt;groupId&gt;org.sakaiproject.kernel&lt;/groupId&gt;
 &lt;artifactId&gt;org.sakaiproject.kernel.doc&lt;/artifactId&gt;
 &lt;version&gt;0.1-SNAPSHOT&lt;/version&gt;
&lt;/dependency&gt;
</pre>
<p>So, add some annotations to your class:</p>
<pre>@SlingServlet(methods = "GET", paths = "/system/doc")
@ServiceDocumentation(name = "DocumentationServlet", description = "Provides auto documentation of servlets registered with OSGi. Documentation will use the "
 + "service registration properties, or annotations if present."
 + " Requests to this servlet take the form /system/doc?p=&amp;lt;classname&amp;gt where &lt;em&gt;classname&lt;/em&gt;"
 + " is the fully qualified name of the class deployed into the OSGi container. If the class is "
 + "not present a 404 will be retruned, if the class is present, it will be interogated to extract "
 + "documentation from the class. In addition to extracting annotation based documention the servlet will "
 + "display the OSGi service properties. All documentation is assumed to be HTML encoded. If the browser is "
 + "directed to &lt;a href=\"/system/doc\" &gt;/system/doc&lt;/a&gt; a list of all servlets in the system will be displayed ",
 bindings = @ServiceBinding(type = BindingType.PATH, bindings = "/system/doc"),
 methods = {
 @ServiceMethod(name = "GET",
 description = "GETs to this servlet will produce documentation for the class, " +
 "or an index of all servlets.",
 parameters = @ServiceParameter(name = "p",
 description = "The name of the class to display the documentation for")) })

public class DocumentationServlet extends SlingSafeMethodsServlet {
</pre>
<p>And then rebuild and reload your Servlet.</p>
<p>Finally browse to <a href="http://localhost:8080/system/doc">http://localhost:8080/system/doc</a> to check the documentation.</p>
<p>&nbsp;</p>
<p>Obviously because the documentation is in the code and its deployed with the code, provided the developer keeps it current with the code they are editing, the documentation will be correct. So the next $64K is "How to make developers document what they do ?"</p>
